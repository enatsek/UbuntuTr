<!DOCTYPE html> <html> <head> </head> <body><H1>Ubuntu&#x27;da Mariadb: Ubuntu 20.04 Üzerinde MariaDB Dökümanı
</H1><p> <a href="javascript:myFunction('Div1')">Copyright (C) 2020 Exforge exforge@karasite.com
</a> <div id="Div1" style="margin-left:10%;"><pre><code># Bu program özgür yazılımdır: Özgür Yazılım Vakfı tarafından yayımlanan 
# GNU Genel Kamu Lisansı’nın sürüm 3 ya da daha sonraki sürümlerinin 
# hükümleri altında yeniden dağıtabilir ve/veya değiştirebilirsiniz.
# Bu program, yararlı olması umuduyla dağıtılmış olup, programın BİR 
# TEMİNATI YOKTUR; TİCARETİNİN YAPILABİLİRLİĞİNE VE ÖZEL BİR AMAÇ İÇİN 
# UYGUNLUĞUNA dair bir teminat da vermez. Ayrıntılar için GNU Genel Kamu 
# Lisansı’na göz atınız.
# Bu programla birlikte GNU Genel Kamu Lisansı’nın bir kopyasını elde 
# etmiş olmanız gerekir. Eğer elinize ulaşmadıysa 
# &lt;http://www.gnu.org/licenses/&gt; adresine bakınız.
</code> </pre> </div> </p>
<p> <a href="javascript:myFunction('Div2')">Özellikler
</a> <div id="Div2" style="margin-left:10%;"><pre><code># Ubuntu 20.04 üzerinde 2 tane Mariadb kurulumu, konfigürastonu, basit kullanıcı yönetimi 
#   ve veritabanı yönetimi
# Jay LaCroix tarafından yazılan Mastering Ubuntu Server 2nd Ed. kitabı temel alınmıştır.
#   Bu kitap Ubuntu Sunucu ile tanışmamı sağladı, kendisine bu mükemmel kitap için
#   çok teşekkür ederim.
#   https://www.packtpub.com/networking-and-servers/mastering-ubuntu-server-second-edition
# Bu dökümandaki hemen hemen herşey MySQL ile de yapılabilir. MariaDB, MySQL&#x27;den türetilmiştir.
#   Ben MySQL yerine MariaDB kullanmayı tercih ediyorum, çünkü Or*cle&#x27;ı pek sevmiyorum.
# !!! Kesinlikle aynı sunucuya hem MariaDB hem de MySQL kurmayın !!!
</code> </pre> </div> </p>
<p> <a href="javascript:myFunction('Div3')">1. Kurulum ve Güvenlileştirme
</a> <div id="Div3" style="margin-left:10%;"><pre><code># 1.1. MariaDB kur
sudo apt install mariadb-server
# 1.2. Kurulumun düzgünlüğünü kontrol et
systemctl status mariadb
#
# 1.3. MariaDB&#x27;yi güvenlileştir
#   Bütün sorulara Y olarak yanıt verin. Şifre istediğinde güvenli bir şifre verin.
sudo mysql_secure_installation
#
# 1.4. Mariadb komut satırına girin
# çıkmak için EXIT; yazın
sudo mariadb
</code> </pre> </div> </p>
<p> <a href="javascript:myFunction('Div4')">2. Yapılandırma (Konfigürasyon) Dosyaları
</a> <div id="Div4" style="margin-left:10%;"><pre><code># 2.1. Yapılandırma dosyaları /etc/mysql dizinindedir
#_______________________________
debian.cnf
debian-start
mariadb.cnf
my.cnf
my.cnf.fallback
#  yukarıdaki dosyalara ek olarak aşağıdaki dizinler de vardır:
conf.d
mariadb.conf.d
#____________________________
#
# 2.2. Örnek /etc/mysql/debian.cnf dosyası
#____________________________
[client]
host = localhost
user= root
password =
socket= /var/run/mysqld/mysqld.sock
[mysql_upgrade]
host = localhost
user = root
password =
socket = /var/run/mysqld/mysqld.sock
basedir = /usr
#____________________________
</code> </pre> </div> </p>
<p> <a href="javascript:myFunction('Div5')">3. MariaDB Komut Satırı
</a> <div id="Div5" style="margin-left:10%;"><pre><code># 3.1. Mariadb komut satırı iki şekilde çalıştırılabilir:
sudo mariadb
#  veya
mariadb -u root -p
# 3.2. İkinciyi kullanabilmek için önce bir ayar yapmak gerekir. sudo mariadb komutuyla
#    MariaDB komut satırına girip, aşağıdaki komutu çalıştırmak gerekir:
UPDATE mysql.user SET plugin = &#x27;mysql_native_password&#x27; WHERE USER=&#x27;root&#x27;;
FLUSH PRIVILEGES;
EXIT;
# Artık aşağıdaki şekilde kullanabiliriz:
mariadb -u root -p
</code> </pre> </div> </p>
<p> <a href="javascript:myFunction('Div6')">4. Temel Kullanıcı Yönetimi
</a> <div id="Div6" style="margin-left:10%;"><pre><code># !!! Bütün komutlar Mariadb komut satırında çalıştırılmalıdır. !!!
# 4.1. Veritabanlarını yönetmek için en iyi yol sadece bilgisayar üzerinde yetkili
#    bir admin kullanıcısı yaratmaktır. Şifreyi değiştirmeyi unutmayın.
CREATE USER &#x27;admin&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;
FLUSH PRIVILEGES;
# 4.2. Admin kullanıcısını sadece bilgisayar üzerinde değil, uzaktan da kullanmak için
#    komutu aşağıdaki şekilde düzeltebilirsiniz.
CREATE USER &#x27;admin&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;password&#x27;;
FLUSH PRIVILEGES;
#
# 4.3. Admin kullanıcısına tam yetki ver, diğer kullanıcıları yetkilendirme kısmı hariç
GRANT ALL PRIVILEGES ON *.* TO &#x27;admin&#x27;@&#x27;localhost&#x27;;
FLUSH PRIVILEGES;
#
# 4.4. Diğer kullanıcıları da yetkilendirebilmesini isterseniz, aşağıdaki şekilde değiştirin:
GRANT ALL PRIVILEGES ON *.* TO &#x27;admin&#x27;@&#x27;localhost&#x27; WITH GRANT OPTION;
FLUSH PRIVILEGES;
#
# 4.5. Sadece okuma yetkili bir kullanıcı yarat
GRANT SELECT ON *.* TO &#x27;readonlyuser&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;
#
# 4.6. Veritabanı kullanıcılarını listele
SELECT HOST, USER, PASSWORD FROM mysql.user;
#
# 4.7. Tek bir veritabanında yetkili, sadece okuma yetkili bir kullanıcı yarat:
GRANT SELECT ON mysampledb.* TO &#x27;appuser&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;
#
# 4.8. Bir kullanıcıya bir veritabanı üzerinde tam yetki ver:
GRANT ALL ON mysampledb.* TO &#x27;appuser&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;
#
# 4.9. Bir kullanıcının yetkilerini göster:
SHOW GRANTS FOR &#x27;appuser&#x27;@&#x27;localhost&#x27;;
#
# 4.10. Kullanıcı silme:
DELETE FROM mysql.user WHERE user=&#x27;myuser&#x27; AND host=&#x27;localhost&#x27;;
</code> </pre> </div> </p>
<p> <a href="javascript:myFunction('Div7')">5. Veritabanı İşlemleri
</a> <div id="Div7" style="margin-left:10%;"><pre><code># !!! Bütün komutlar Mariadb komut satırında çalıştırılmalıdır. !!!
# 5.1. Bir veritabanı yarat
CREATE DATABASE mysampledb;
#
# 5.2. Veritabanlarını listele
SHOW DATABASES;
#
# 5.3. Bir veritabanının çalışma alanına gir
#   (Bir veritabanını varsayılan veritabanı yap)
USE mysampledb;
#
# 5.4. Tablo yarat
CREATE TABLE Employees (Name char(15), Age int(3), Occupation char(15));
#
# 5.5. Tablonun kolonlarını listele
SHOW COLUMNS IN Employees;
#
# 5.6. Tabloya satır ekle
INSERT INTO Employees VALUES (&#x27;Joe Smith&#x27;, &#x27;26&#x27;, &#x27;Ninja&#x27;);
#
# 5.7. Tablonun içeriğini listele
SELECT * FROM Employees;
#
# 5.8. Tablodan bir kayıt sil
DELETE FROM Employees WHERE Name = &#x27;Joe Smith&#x27;;
#
# 5.9. Bir tabloyu tamamen sil (Drop)
DROP TABLE Employees;
#
# 5.10. Bütün veritabanını sil (Drop):
DROP DATABASE mysampledb;
</code> </pre> </div> </p>
<p> <a href="javascript:myFunction('Div8')">6. Yedek Alma ve Geri Yükleme
</a> <div id="Div8" style="margin-left:10%;"><pre><code># 6.1. Veritabanını Yedekle
mysqldump -u admin -p --databases mysampledb &gt; mysampledb.sql
#
# 6.2. Geri Yükle
mariadb -u admin -p &lt; mysampledb.sql
</code> </pre> </div> </p>
<p> <a href="javascript:myFunction('Div9')">7. Aktif-Pasif Yineleme Yapılandırması (Master-Slave Replication)
</a> <div id="Div9" style="margin-left:10%;"><pre><code>#   Bir sunucudaki veritabanı, otomatik olarak başka bir sunucuda yedeklenir.
# 7.1. Özellikler ve Ön İşlemler. 
#   Aktif Sunucu: 172.16.63.128
#   Pasif Sunucu:  172.16.63.131
#   Yineleme Kullanıcısı: &#x27;replicate&#x27;@&#x27;172.16.63.131&#x27;
#   Yin. Kullanıcısı Şifresi: Pass1234 
#   Yinelenecek Veritabanı: mysampledb
#
#   İki sunucuya da mariadb yükleyin,
#   1. ve 3. adımları her iki sunucuda da gerçekleştirin
#   5.1.&#x27;den 5.7.&#x27;ye kadar olan adımları aktif sunucuda gerçekleştirin
#
#   !!! Lütfen Unutmayın: !!! 
#      Aktif-Pasif yineleme yapmak, yedekleme gerekliliğini ortadan kaldırmaz.
#      Herhangi bir şey yanlışlıkla silinirse, pasif sunucuda da silinir.
#      Bir üretim sunucusu kullanıyorsanız, en azından günlük ve haftalık olarak
#      yedeklemeniz gerekir.
#
# 7.2. Aktif Sunucu Yapılandırması
# 7.2.1. Aktif sunucuda bin log yapılandırması
sudo nano /etc/mysql/conf.d/mysql.cnf
#__________________
[mysql]
[mysqld]
log-bin
binlog-do-db=mysampledb
server-id=1
#__________________
# 7.2.2. Bind adresini dışarıya aç
sudo nano /etc/mysql/mariadb.conf.d/50-server.cnf
# Aşağıdaki satırı değiştireceksiniz:
#_______________________
bind-address = 127.0.0.1
#_______________________
#  aşağıdaki hale getirin:
#_______________________
bind-address = 0.0.0.0
#_______________________
# 7.2.3. Yineleme kullanıcısını yaratın
#   Aşadağıdaki komutu aktif sunucu Mariadb komut satırında çalıştırın
GRANT REPLICATION SLAVE ON *.* to &#x27;replicate&#x27;@&#x27;172.16.63.131&#x27; identified by &#x27;Pass1234&#x27;;
#
# 7.2.4. Aktif mariadb sunucusunu yeniden başlatın
sudo systemctl restart mariadb
#
# 7.2.5. İlk tüm yineleme için Aktif sunucuyu kilitleyin
#   Aktif sunucu Mariadb komut satırında çalıştırın
FLUSH TABLES WITH READ LOCK;
#
# 7.2.6. Aktif sunucudaki veritabanının yedeğini alın
mysqldump -u admin -p --databases mysampledb &gt; mysampledb.sql
# Yedek almış olduğunuz dosyayı (mysampledb.sql) pasif sunucuya da kopyalamanız gerekecektir.
#
# 7.3. Pasif Sunucu Yapılandırması
# 7.3.1. Aktif sunucuda aldığınız yedeği, pasif sunucuda geri yükleyin
mariadb -u root -p &lt; mysampledb.sql
#
# 7.3.2. Pasif sunucu yapılandırma dosyasını güncelleyin
sudo nano /etc/mysql/conf.d/mysql.cnf
#__________________
[mysql]
[mysqld]
server-id=2
#__________________
#  Birden fazla pasif sunucu kuracaksanız, her birine farklı server-id vermeniz gerekir
#
# 7.3.3. Pasif sunucudaki mariadb&#x27;yi yeniden başlat
sudo systemctl restart mariadb
#
# 7.3.4. Aşağıdaki komutları pasif sunucu mariadb konut satırında çalıştırın
CHANGE MASTER TO MASTER_HOST=&quot;172.16.63.128&quot;, MASTER_USER=&#x27;replicate&#x27;, MASTER_PASSWORD=&#x27;Pass1234&#x27;;
# Pasif sunucunun durumuna bakmak için (mariadb komut satırı)
SHOW SLAVE STATUSG;
# Slave_IO_State alanı boşsa (mariadb komut satırı)
START SLAVE;
#
# 7.4. Aktif sunucudaki Mariadb kilidini kaldırın
#   aktif sunucunun mariadb komut satırında çalıştırın
UNLOCK TABLES;
# 7.5. İşlem tamamlandı. Aktif sunucudaki veritabanında değişiklikler yaparak test edebilirsiniz.
#   Birkaç saniye içinde pasif sunucuda da değişiklikler aktif olacaktır.
</code> </pre> </div> </p>
</code> </pre> </div> </p>
<br /><br /><br /><script>
function myFunction(divid) {
  var x = document.getElementById(divid);
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
var i;
var str;

for (i=1; i<10; i++) {
    str = "Div" + i.toString();
    myFunction(str);
}
</script></body> </html>